<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGI Trinity - Multi-Agent AI Orchestrator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xz/fonts@1/serve/plus-jakarta-sans.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --dark: #0f172a;
            --darker: #020617;
        }

        * {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #1e1b4b 100%);
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glow {
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }

        .agent-card {
            transition: all 0.3s ease;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .typing-indicator span {
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.5; }
            100% { transform: scale(0.8); opacity: 1; }
        }

        #peer-status.connected { color: #10b981; }
        #peer-status.disconnected { color: #ef4444; }
    </style>
</head>
<body class="text-white">
    <!-- Header -->
    <header class="glass fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-cyan-400 flex items-center justify-center pulse-ring">
                    <span class="text-xl">ğŸ¤–</span>
                </div>
                <span class="text-xl font-bold gradient-text">AGI Trinity</span>
            </div>

            <nav class="hidden md:flex space-x-8">
                <a href="#demo" class="hover:text-cyan-400 transition">Demo</a>
                <a href="#agents" class="hover:text-cyan-400 transition">Agents</a>
                <a href="#p2p" class="hover:text-cyan-400 transition">P2P Network</a>
                <a href="#metrics" class="hover:text-cyan-400 transition">Metrics</a>
            </nav>

            <div class="flex items-center space-x-4">
                <span id="peer-status" class="text-sm disconnected">â— Offline</span>
                <a href="https://github.com/hwkim3330/agi" target="_blank"
                   class="px-4 py-2 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:opacity-90 transition">
                    GitHub
                </a>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="pt-32 pb-20 px-6">
        <div class="container mx-auto text-center">
            <h1 class="text-5xl md:text-7xl font-bold mb-6">
                <span class="gradient-text">Three Minds</span><br>
                <span class="text-gray-300">One Consciousness</span>
            </h1>
            <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-10">
                Claude, Gemini, GPT-4ë¥¼ í†µí•©í•œ ì§‘ë‹¨ ì§€ëŠ¥ ì‹œìŠ¤í…œ.<br>
                PeerJSë¥¼ í†µí•œ ë¶„ì‚° P2P ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
            </p>
            <div class="flex justify-center space-x-4">
                <button onclick="scrollToDemo()" class="px-8 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-cyan-500 text-lg font-semibold hover:opacity-90 transition">
                    Try Demo
                </button>
                <button onclick="initP2P()" class="px-8 py-3 rounded-full glass hover:bg-white/10 transition">
                    Connect P2P
                </button>
            </div>
        </div>
    </section>

    <!-- Agents Section -->
    <section id="agents" class="py-20 px-6">
        <div class="container mx-auto">
            <h2 class="text-3xl font-bold text-center mb-12 gradient-text">AI Agents</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <!-- Claude -->
                <div class="agent-card glass rounded-2xl p-6">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center mb-4">
                        <span class="text-2xl">ğŸ§ </span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Claude</h3>
                    <p class="text-gray-400 text-sm mb-4">Technical Expert</p>
                    <ul class="text-sm text-gray-300 space-y-2">
                        <li>âœ“ ì½”ë“œ ë¶„ì„ ë° ë””ë²„ê¹…</li>
                        <li>âœ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„</li>
                        <li>âœ“ ë³´ì•ˆ ì·¨ì•½ì  íƒì§€</li>
                        <li>âœ“ ì„±ëŠ¥ ìµœì í™” ì œì•ˆ</li>
                    </ul>
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>ì‘ë‹µ ì‹œê°„</span>
                            <span id="claude-latency">-</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-1.5 mt-2">
                            <div id="claude-bar" class="bg-orange-500 h-1.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Gemini -->
                <div class="agent-card glass rounded-2xl p-6">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center mb-4">
                        <span class="text-2xl">ğŸ“Š</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Gemini</h3>
                    <p class="text-gray-400 text-sm mb-4">Data Analyst</p>
                    <ul class="text-sm text-gray-300 space-y-2">
                        <li>âœ“ ì¢…í•©ì ì¸ ë¦¬ì„œì¹˜</li>
                        <li>âœ“ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™”</li>
                        <li>âœ“ íŒ©íŠ¸ ì²´í‚¹</li>
                        <li>âœ“ ì‹œì¥ ë¶„ì„</li>
                    </ul>
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>ì‘ë‹µ ì‹œê°„</span>
                            <span id="gemini-latency">-</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-1.5 mt-2">
                            <div id="gemini-bar" class="bg-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- GPT-4 -->
                <div class="agent-card glass rounded-2xl p-6">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center mb-4">
                        <span class="text-2xl">ğŸ’¡</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">GPT-4</h3>
                    <p class="text-gray-400 text-sm mb-4">Creative Solver</p>
                    <ul class="text-sm text-gray-300 space-y-2">
                        <li>âœ“ ì°½ì˜ì  ë¬¸ì œ í•´ê²°</li>
                        <li>âœ“ ì „ëµì  í˜ì‹ </li>
                        <li>âœ“ ë¸Œë ˆì¸ìŠ¤í† ë°</li>
                        <li>âœ“ ë‚´ëŸ¬í‹°ë¸Œ ìƒì„±</li>
                    </ul>
                    <div class="mt-4 pt-4 border-t border-white/10">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>ì‘ë‹µ ì‹œê°„</span>
                            <span id="gpt4-latency">-</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-1.5 mt-2">
                            <div id="gpt4-bar" class="bg-green-500 h-1.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Demo Section -->
    <section id="demo" class="py-20 px-6 bg-black/20">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl font-bold text-center mb-12 gradient-text">Live Demo</h2>

            <div class="glass rounded-2xl p-6">
                <!-- Input -->
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">ì§ˆë¬¸ ì…ë ¥</label>
                    <div class="flex space-x-3">
                        <input type="text" id="prompt-input"
                               placeholder="ì˜ˆ: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ì¥ë‹¨ì ì„ ë¶„ì„í•´ì£¼ì„¸ìš”"
                               class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-indigo-500">
                        <button onclick="runDemo()" id="run-btn"
                                class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 font-semibold hover:opacity-90 transition">
                            ì‹¤í–‰
                        </button>
                    </div>
                </div>

                <!-- Strategy -->
                <div class="mb-6">
                    <label class="block text-sm text-gray-400 mb-2">í•©ì˜ ì „ëµ</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="strategy" value="vote" checked class="text-indigo-500">
                            <span>Vote</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="strategy" value="synthesis" class="text-indigo-500">
                            <span>Synthesis</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="strategy" value="semantic" class="text-indigo-500">
                            <span>Semantic</span>
                        </label>
                    </div>
                </div>

                <!-- Output -->
                <div id="output-area" class="hidden">
                    <div class="border-t border-white/10 pt-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-semibold">Trinity í•©ì˜ ê²°ê³¼</h3>
                            <span id="confidence-badge" class="px-3 py-1 rounded-full bg-green-500/20 text-green-400 text-sm">
                                ì‹ ë¢°ë„: -
                            </span>
                        </div>
                        <div id="result-content" class="bg-black/30 rounded-xl p-4 text-gray-300 whitespace-pre-wrap">
                        </div>
                    </div>
                </div>

                <!-- Loading -->
                <div id="loading" class="hidden text-center py-8">
                    <div class="typing-indicator inline-flex space-x-1">
                        <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                        <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                        <span class="w-2 h-2 bg-indigo-500 rounded-full"></span>
                    </div>
                    <p class="text-gray-400 mt-3">ì—ì´ì „íŠ¸ë“¤ì´ ë¶„ì„ ì¤‘...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- P2P Section -->
    <section id="p2p" class="py-20 px-6">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl font-bold text-center mb-12 gradient-text">P2P Network</h2>

            <div class="glass rounded-2xl p-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- My Peer ID -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ë‚´ Peer ID</label>
                        <div class="flex space-x-2">
                            <input type="text" id="my-peer-id" readonly
                                   class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 font-mono text-sm">
                            <button onclick="copyPeerId()" class="px-4 rounded-xl bg-white/10 hover:bg-white/20 transition">
                                ğŸ“‹
                            </button>
                        </div>
                    </div>

                    <!-- Connect to Peer -->
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">í”¼ì–´ ì—°ê²°</label>
                        <div class="flex space-x-2">
                            <input type="text" id="remote-peer-id" placeholder="ì›ê²© Peer ID ì…ë ¥"
                                   class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3">
                            <button onclick="connectToPeer()" class="px-4 rounded-xl bg-indigo-600 hover:bg-indigo-700 transition">
                                ì—°ê²°
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Connected Peers -->
                <div class="mt-6">
                    <h4 class="text-sm text-gray-400 mb-3">ì—°ê²°ëœ í”¼ì–´</h4>
                    <div id="connected-peers" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="text-center text-gray-500 col-span-full py-4">
                            ì—°ê²°ëœ í”¼ì–´ê°€ ì—†ìŠµë‹ˆë‹¤
                        </div>
                    </div>
                </div>

                <!-- P2P Chat -->
                <div class="mt-6 border-t border-white/10 pt-6">
                    <h4 class="text-sm text-gray-400 mb-3">P2P ë©”ì‹œì§€</h4>
                    <div id="p2p-messages" class="bg-black/30 rounded-xl p-4 h-32 overflow-y-auto mb-3 text-sm">
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="p2p-message" placeholder="ë©”ì‹œì§€ ì…ë ¥..."
                               class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-2">
                        <button onclick="sendP2PMessage()" class="px-4 rounded-xl bg-cyan-600 hover:bg-cyan-700 transition">
                            ì „ì†¡
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Metrics Section -->
    <section id="metrics" class="py-20 px-6 bg-black/20">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl font-bold text-center mb-12 gradient-text">Performance Metrics</h2>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Latency Chart -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="font-semibold mb-4">ì‘ë‹µ ì‹œê°„ (ms)</h3>
                    <canvas id="latency-chart"></canvas>
                </div>

                <!-- Success Rate -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="font-semibold mb-4">ì„±ê³µë¥ </h3>
                    <canvas id="success-chart"></canvas>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold gradient-text" id="total-requests">0</div>
                    <div class="text-xs text-gray-400">ì´ ìš”ì²­</div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-green-400" id="success-rate">0%</div>
                    <div class="text-xs text-gray-400">ì„±ê³µë¥ </div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-cyan-400" id="avg-latency">0ms</div>
                    <div class="text-xs text-gray-400">í‰ê·  ì‘ë‹µì‹œê°„</div>
                </div>
                <div class="glass rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-purple-400" id="connected-count">0</div>
                    <div class="text-xs text-gray-400">ì—°ê²°ëœ í”¼ì–´</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-10 px-6 border-t border-white/10">
        <div class="container mx-auto text-center">
            <p class="text-gray-500">
                AGI Trinity - Multi-Agent AI Orchestrator<br>
                <span class="text-sm">Built with Claude, Gemini, GPT-4 & PeerJS</span>
            </p>
        </div>
    </footer>

    <script>
        // Global state
        let peer = null;
        let connections = [];
        let metrics = {
            totalRequests: 0,
            successfulRequests: 0,
            latencies: []
        };

        // Initialize charts
        let latencyChart, successChart;

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
        });

        function initCharts() {
            const latencyCtx = document.getElementById('latency-chart').getContext('2d');
            latencyChart = new Chart(latencyCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Claude', data: [], borderColor: '#f97316', tension: 0.4 },
                        { label: 'Gemini', data: [], borderColor: '#3b82f6', tension: 0.4 },
                        { label: 'GPT-4', data: [], borderColor: '#10b981', tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    scales: {
                        x: { ticks: { color: '#9ca3af' }, grid: { color: '#374151' } },
                        y: { ticks: { color: '#9ca3af' }, grid: { color: '#374151' } }
                    }
                }
            });

            const successCtx = document.getElementById('success-chart').getContext('2d');
            successChart = new Chart(successCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ì„±ê³µ', 'ì‹¤íŒ¨'],
                    datasets: [{
                        data: [100, 0],
                        backgroundColor: ['#10b981', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#9ca3af' } } }
                }
            });
        }

        // P2P Functions
        function initP2P() {
            peer = new Peer();

            peer.on('open', (id) => {
                document.getElementById('my-peer-id').value = id;
                document.getElementById('peer-status').textContent = 'â— Online';
                document.getElementById('peer-status').className = 'text-sm connected';
                addP2PMessage('System', `Connected as ${id}`);
            });

            peer.on('connection', (conn) => {
                handleConnection(conn);
            });

            peer.on('error', (err) => {
                addP2PMessage('Error', err.message);
            });
        }

        function connectToPeer() {
            const remotePeerId = document.getElementById('remote-peer-id').value;
            if (!remotePeerId || !peer) return;

            const conn = peer.connect(remotePeerId);
            handleConnection(conn);
        }

        function handleConnection(conn) {
            conn.on('open', () => {
                connections.push(conn);
                updateConnectedPeers();
                addP2PMessage('System', `Connected to ${conn.peer}`);
            });

            conn.on('data', (data) => {
                if (data.type === 'message') {
                    addP2PMessage(conn.peer.slice(0, 8), data.content);
                } else if (data.type === 'query') {
                    // Handle distributed query
                    handleDistributedQuery(data, conn);
                }
            });

            conn.on('close', () => {
                connections = connections.filter(c => c !== conn);
                updateConnectedPeers();
            });
        }

        function sendP2PMessage() {
            const message = document.getElementById('p2p-message').value;
            if (!message) return;

            connections.forEach(conn => {
                conn.send({ type: 'message', content: message });
            });

            addP2PMessage('Me', message);
            document.getElementById('p2p-message').value = '';
        }

        function addP2PMessage(sender, content) {
            const container = document.getElementById('p2p-messages');
            const msg = document.createElement('div');
            msg.className = 'mb-1';
            msg.innerHTML = `<span class="text-indigo-400">${sender}:</span> ${content}`;
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
        }

        function updateConnectedPeers() {
            const container = document.getElementById('connected-peers');
            document.getElementById('connected-count').textContent = connections.length;

            if (connections.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 col-span-full py-4">ì—°ê²°ëœ í”¼ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = connections.map(conn => `
                <div class="glass rounded-lg p-2 text-center">
                    <div class="text-green-400 text-xs">â—</div>
                    <div class="font-mono text-xs truncate">${conn.peer.slice(0, 12)}...</div>
                </div>
            `).join('');
        }

        function copyPeerId() {
            const peerId = document.getElementById('my-peer-id').value;
            navigator.clipboard.writeText(peerId);
        }

        // Demo Functions
        async function runDemo() {
            const prompt = document.getElementById('prompt-input').value;
            if (!prompt) return;

            const strategy = document.querySelector('input[name="strategy"]:checked').value;

            // Show loading
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('output-area').classList.add('hidden');
            document.getElementById('run-btn').disabled = true;

            // Simulate agent responses
            const responses = await simulateAgentResponses(prompt);

            // Calculate consensus
            const consensus = calculateConsensus(responses, strategy);

            // Update UI
            displayResult(consensus);
            updateMetrics(responses);

            // Broadcast to P2P network
            broadcastQuery(prompt, consensus);
        }

        async function simulateAgentResponses(prompt) {
            // Simulated responses (in production, would call actual APIs)
            const agents = ['claude', 'gemini', 'gpt4'];
            const responses = [];

            for (const agent of agents) {
                await sleep(Math.random() * 1000 + 500);

                const latency = Math.random() * 2 + 0.5;
                updateAgentProgress(agent, latency);

                responses.push({
                    agent_name: agent,
                    content: generateMockResponse(agent, prompt),
                    success: Math.random() > 0.1,
                    latency: latency,
                    confidence: Math.random() * 0.3 + 0.7
                });
            }

            return responses;
        }

        function generateMockResponse(agent, prompt) {
            const responses = {
                claude: `[Claude ë¶„ì„]\n\nê¸°ìˆ ì  ê´€ì ì—ì„œ "${prompt}"ì— ëŒ€í•´ ë¶„ì„í•˜ë©´:\n\n1. ì•„í‚¤í…ì²˜ ê³ ë ¤ì‚¬í•­\n2. ì„±ëŠ¥ ìµœì í™” ë°©ì•ˆ\n3. ë³´ì•ˆ ê²€í†  ê²°ê³¼\n\nìƒì„¸ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                gemini: `[Gemini ë¦¬ì„œì¹˜]\n\n"${prompt}"ì— ëŒ€í•œ ë°ì´í„° ë¶„ì„:\n\n- ì‹œì¥ ë™í–¥ ë¶„ì„\n- í†µê³„ì  ê²€ì¦ ê²°ê³¼\n- íŒ©íŠ¸ ì²´í‚¹ ì™„ë£Œ\n\nì¢…í•©ì ì¸ ë¦¬ì„œì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                gpt4: `[GPT-4 ì°½ì˜ì  ì œì•ˆ]\n\n"${prompt}"ì— ëŒ€í•œ í˜ì‹ ì  ì ‘ê·¼:\n\nğŸ’¡ ì•„ì´ë””ì–´ 1: ìƒˆë¡œìš´ ê´€ì \nğŸ’¡ ì•„ì´ë””ì–´ 2: ëŒ€ì•ˆì  ì†”ë£¨ì…˜\nğŸ’¡ ì•„ì´ë””ì–´ 3: ë¯¸ë˜ ë¹„ì „\n\nì°½ì˜ì  ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`
            };
            return responses[agent];
        }

        function calculateConsensus(responses, strategy) {
            const successful = responses.filter(r => r.success);
            const confidence = successful.length / responses.length;

            let content;
            if (strategy === 'synthesis') {
                content = successful.map(r => r.content).join('\n\n---\n\n');
            } else if (strategy === 'semantic') {
                // Pick highest confidence
                const best = successful.reduce((a, b) => a.confidence > b.confidence ? a : b);
                content = `[Semantic í•©ì˜ - ${best.agent_name} ì„ íƒ]\n\n${best.content}`;
            } else {
                // Vote - pick longest
                const best = successful.reduce((a, b) => a.content.length > b.content.length ? a : b);
                content = `[Vote í•©ì˜ - ${best.agent_name} ì„ íƒ]\n\n${best.content}`;
            }

            return { content, confidence, strategy };
        }

        function displayResult(consensus) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('output-area').classList.remove('hidden');
            document.getElementById('run-btn').disabled = false;

            document.getElementById('result-content').textContent = consensus.content;
            document.getElementById('confidence-badge').textContent = `ì‹ ë¢°ë„: ${(consensus.confidence * 100).toFixed(0)}%`;
        }

        function updateAgentProgress(agent, latency) {
            const latencyEl = document.getElementById(`${agent === 'gpt4' ? 'gpt4' : agent}-latency`);
            const barEl = document.getElementById(`${agent === 'gpt4' ? 'gpt4' : agent}-bar`);

            if (latencyEl) latencyEl.textContent = `${(latency * 1000).toFixed(0)}ms`;
            if (barEl) barEl.style.width = `${Math.min(100, latency * 50)}%`;
        }

        function updateMetrics(responses) {
            metrics.totalRequests++;
            metrics.successfulRequests += responses.filter(r => r.success).length / responses.length;
            metrics.latencies.push(responses.reduce((sum, r) => sum + r.latency, 0) / responses.length);

            // Update stats
            document.getElementById('total-requests').textContent = metrics.totalRequests;
            document.getElementById('success-rate').textContent = `${((metrics.successfulRequests / metrics.totalRequests) * 100).toFixed(0)}%`;
            document.getElementById('avg-latency').textContent = `${(metrics.latencies.reduce((a, b) => a + b, 0) / metrics.latencies.length * 1000).toFixed(0)}ms`;

            // Update charts
            const label = new Date().toLocaleTimeString();
            latencyChart.data.labels.push(label);
            responses.forEach((r, i) => {
                latencyChart.data.datasets[i].data.push(r.latency * 1000);
            });
            if (latencyChart.data.labels.length > 10) {
                latencyChart.data.labels.shift();
                latencyChart.data.datasets.forEach(d => d.data.shift());
            }
            latencyChart.update();

            successChart.data.datasets[0].data = [
                metrics.successfulRequests,
                metrics.totalRequests - metrics.successfulRequests
            ];
            successChart.update();
        }

        function broadcastQuery(prompt, consensus) {
            if (connections.length === 0) return;

            connections.forEach(conn => {
                conn.send({
                    type: 'query',
                    prompt: prompt,
                    result: consensus
                });
            });

            addP2PMessage('Broadcast', `Query shared with ${connections.length} peers`);
        }

        function handleDistributedQuery(data, conn) {
            addP2PMessage(conn.peer.slice(0, 8), `Received query: ${data.prompt.slice(0, 50)}...`);
        }

        function scrollToDemo() {
            document.getElementById('demo').scrollIntoView({ behavior: 'smooth' });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
